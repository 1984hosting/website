server {
    listen       4000;
    server_name  localhost;

    location / {
        rewrite ^(/.*)\.html(\?.*)?$ $1$2 permanent;
        rewrite ^/(.*)/$ /$1 permanent;

        root   /usr/share/nginx/html;
        index  index.html index.htm;

        try_files $uri/index.html $uri.html $uri/ $uri =404;
    }

    location = /i/ {
        if ($args ~* "server=(.*)&os=(.*)") {
            set $server $1;
            set $os $2;
            rewrite ^ /i/$os-$server? permanent;
        }
    }
}
